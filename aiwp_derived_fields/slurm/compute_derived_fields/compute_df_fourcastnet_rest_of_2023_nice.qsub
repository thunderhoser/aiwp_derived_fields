#!/bin/bash

#SBATCH --job-name="compute_df_fourcastnet_rest_of_2023_nice"
#SBATCH --partition="fge"
#SBATCH --account="rda-ghpcs"
#SBATCH --qos="gpuwf"
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
##SBATCH --nodes=1
##SBATCH --ntasks=1
##SBATCH --cpus-per-task=1
##SBATCH --ntasks-per-node=1
#SBATCH --time=24:00:00
#SBATCH --array=0,10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630,640,650,660,670,680,690,700,710,720,730,740,750,760,770,780,790,800,810,820,830,840%40
#SBATCH --exclude=h28n12
##SBATCH --exclude=h31n03,h28n12
##SBATCH --exclude=h29n01,h26n05,h28n06,h29n07,h30n03,h30n15
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=ryan.lagerquist@noaa.gov
#SBATCH --output=compute_df_fourcastnet_rest_of_2023_nice_%A_%a.out

conda init
conda activate base

echo `which conda`
echo `which python`
echo `which python3`

# PATH=/usr/local/cuda/bin:$PATH
echo $PATH

CODE_DIR_NAME="/scratch1/RDARCH/rda-ghpcs/Ryan.Lagerquist/aiwp_derived_fields/aiwp_derived_fields/scripts"
INPUT_DIR_NAME="/scratch2/NCEPDEV/stmp/Ryan.Lagerquist/aws_cli_test/FOUR_v200"
OUTPUT_DIR_NAME="/scratch2/STI/mdl-sti/Ryan.Lagerquist/noaa-oar-mlwp-data.s3.amazonaws.com/new_aiwp_derived_fields"

INIT_TIME_STRINGS=("2023-01-01-00" "2023-01-01-06" "2023-01-01-12" "2023-01-01-18" "2023-01-02-00" "2023-01-02-06" "2023-01-02-12" "2023-01-02-18" "2023-01-03-00" "2023-01-03-06" "2023-01-03-12" "2023-01-03-18" "2023-01-04-00" "2023-01-04-06" "2023-01-04-12" "2023-01-04-18" "2023-01-05-00" "2023-01-05-06" "2023-01-05-12" "2023-01-05-18" "2023-01-06-00" "2023-01-06-06" "2023-01-06-12" "2023-01-06-18" "2023-01-07-00" "2023-01-07-06" "2023-01-07-12" "2023-01-07-18" "2023-01-08-00" "2023-01-08-06" "2023-01-08-12" "2023-01-08-18" "2023-01-09-00" "2023-01-09-06" "2023-01-09-12" "2023-01-09-18" "2023-01-10-00" "2023-01-10-06" "2023-01-10-12" "2023-01-10-18" "2023-01-11-00" "2023-01-11-06" "2023-01-11-12" "2023-01-11-18" "2023-01-12-00" "2023-01-12-06" "2023-01-12-12" "2023-01-12-18" "2023-01-13-00" "2023-01-13-06" "2023-01-13-12" "2023-01-13-18" "2023-01-14-00" "2023-01-14-06" "2023-01-14-12" "2023-01-14-18" "2023-01-15-00" "2023-01-15-06" "2023-01-15-12" "2023-01-15-18" "2023-01-16-00" "2023-01-16-06" "2023-01-16-12" "2023-01-16-18" "2023-01-17-00" "2023-01-17-06" "2023-01-17-12" "2023-01-17-18" "2023-01-18-00" "2023-01-18-06" "2023-01-18-12" "2023-01-18-18" "2023-01-19-00" "2023-01-19-06" "2023-01-19-12" "2023-01-19-18" "2023-01-20-00" "2023-01-20-06" "2023-01-20-12" "2023-01-20-18" "2023-01-21-00" "2023-01-21-06" "2023-01-21-12" "2023-01-21-18" "2023-01-22-00" "2023-01-22-06" "2023-01-22-12" "2023-01-22-18" "2023-01-23-00" "2023-01-23-06" "2023-01-23-12" "2023-01-23-18" "2023-01-24-00" "2023-01-24-06" "2023-01-24-12" "2023-01-24-18" "2023-01-25-00" "2023-01-25-06" "2023-01-25-12" "2023-01-25-18" "2023-01-26-00" "2023-01-26-06" "2023-01-26-12" "2023-01-26-18" "2023-01-27-00" "2023-01-27-06" "2023-01-27-12" "2023-01-27-18" "2023-01-28-00" "2023-01-28-06" "2023-01-28-12" "2023-01-28-18" "2023-01-29-00" "2023-01-29-06" "2023-01-29-12" "2023-01-29-18" "2023-01-30-00" "2023-01-30-06" "2023-01-30-12" "2023-01-30-18" "2023-01-31-00" "2023-01-31-06" "2023-01-31-12" "2023-01-31-18" "2023-02-01-00" "2023-02-01-06" "2023-02-01-12" "2023-02-01-18" "2023-02-02-00" "2023-02-02-06" "2023-02-02-12" "2023-02-02-18" "2023-02-03-00" "2023-02-03-06" "2023-02-03-12" "2023-02-03-18" "2023-02-04-00" "2023-02-04-06" "2023-02-04-12" "2023-02-04-18" "2023-02-05-00" "2023-02-05-06" "2023-02-05-12" "2023-02-05-18" "2023-02-06-00" "2023-02-06-06" "2023-02-06-12" "2023-02-06-18" "2023-02-07-00" "2023-02-07-06" "2023-02-07-12" "2023-02-07-18" "2023-02-08-00" "2023-02-08-06" "2023-02-08-12" "2023-02-08-18" "2023-02-09-00" "2023-02-09-06" "2023-02-09-12" "2023-02-09-18" "2023-02-10-00" "2023-02-10-06" "2023-02-10-12" "2023-02-10-18" "2023-02-11-00" "2023-02-11-06" "2023-02-11-12" "2023-02-11-18" "2023-02-12-00" "2023-02-12-06" "2023-02-12-12" "2023-02-12-18" "2023-02-13-00" "2023-02-13-06" "2023-02-13-12" "2023-02-13-18" "2023-02-14-00" "2023-02-14-06" "2023-02-14-12" "2023-02-14-18" "2023-02-15-00" "2023-02-15-06" "2023-02-15-12" "2023-02-15-18" "2023-02-16-00" "2023-02-16-06" "2023-02-16-12" "2023-02-16-18" "2023-02-17-00" "2023-02-17-06" "2023-02-17-12" "2023-02-17-18" "2023-02-18-00" "2023-02-18-06" "2023-02-18-12" "2023-02-18-18" "2023-02-19-00" "2023-02-19-06" "2023-02-19-12" "2023-02-19-18" "2023-02-20-00" "2023-02-20-06" "2023-02-20-12" "2023-02-20-18" "2023-02-21-00" "2023-02-21-06" "2023-02-21-12" "2023-02-21-18" "2023-02-22-00" "2023-02-22-06" "2023-02-22-12" "2023-02-22-18" "2023-02-23-00" "2023-02-23-06" "2023-02-23-12" "2023-02-23-18" "2023-02-24-00" "2023-02-24-06" "2023-02-24-12" "2023-02-24-18" "2023-02-25-00" "2023-02-25-06" "2023-02-25-12" "2023-02-25-18" "2023-02-26-00" "2023-02-26-06" "2023-02-26-12" "2023-02-26-18" "2023-02-27-00" "2023-02-27-06" "2023-02-27-12" "2023-02-27-18" "2023-02-28-00" "2023-02-28-06" "2023-02-28-12" "2023-02-28-18" "2023-06-01-00" "2023-06-01-06" "2023-06-01-12" "2023-06-01-18" "2023-06-02-00" "2023-06-02-06" "2023-06-02-12" "2023-06-02-18" "2023-06-03-00" "2023-06-03-06" "2023-06-03-12" "2023-06-03-18" "2023-06-04-00" "2023-06-04-06" "2023-06-04-12" "2023-06-04-18" "2023-06-05-00" "2023-06-05-06" "2023-06-05-12" "2023-06-05-18" "2023-06-06-00" "2023-06-06-06" "2023-06-06-12" "2023-06-06-18" "2023-06-07-00" "2023-06-07-06" "2023-06-07-12" "2023-06-07-18" "2023-06-08-00" "2023-06-08-06" "2023-06-08-12" "2023-06-08-18" "2023-06-09-00" "2023-06-09-06" "2023-06-09-12" "2023-06-09-18" "2023-06-10-00" "2023-06-10-06" "2023-06-10-12" "2023-06-10-18" "2023-06-11-00" "2023-06-11-06" "2023-06-11-12" "2023-06-11-18" "2023-06-12-00" "2023-06-12-06" "2023-06-12-12" "2023-06-12-18" "2023-06-13-00" "2023-06-13-06" "2023-06-13-12" "2023-06-13-18" "2023-06-14-00" "2023-06-14-06" "2023-06-14-12" "2023-06-14-18" "2023-06-15-00" "2023-06-15-06" "2023-06-15-12" "2023-06-15-18" "2023-06-16-00" "2023-06-16-06" "2023-06-16-12" "2023-06-16-18" "2023-06-17-00" "2023-06-17-06" "2023-06-17-12" "2023-06-17-18" "2023-06-18-00" "2023-06-18-06" "2023-06-18-12" "2023-06-18-18" "2023-06-19-00" "2023-06-19-06" "2023-06-19-12" "2023-06-19-18" "2023-06-20-00" "2023-06-20-06" "2023-06-20-12" "2023-06-20-18" "2023-06-21-00" "2023-06-21-06" "2023-06-21-12" "2023-06-21-18" "2023-06-22-00" "2023-06-22-06" "2023-06-22-12" "2023-06-22-18" "2023-06-23-00" "2023-06-23-06" "2023-06-23-12" "2023-06-23-18" "2023-06-24-00" "2023-06-24-06" "2023-06-24-12" "2023-06-24-18" "2023-06-25-00" "2023-06-25-06" "2023-06-25-12" "2023-06-25-18" "2023-06-26-00" "2023-06-26-06" "2023-06-26-12" "2023-06-26-18" "2023-06-27-00" "2023-06-27-06" "2023-06-27-12" "2023-06-27-18" "2023-06-28-00" "2023-06-28-06" "2023-06-28-12" "2023-06-28-18" "2023-06-29-00" "2023-06-29-06" "2023-06-29-12" "2023-06-29-18" "2023-06-30-00" "2023-06-30-06" "2023-06-30-12" "2023-06-30-18" "2023-07-01-00" "2023-07-01-06" "2023-07-01-12" "2023-07-01-18" "2023-07-02-00" "2023-07-02-06" "2023-07-02-12" "2023-07-02-18" "2023-07-03-00" "2023-07-03-06" "2023-07-03-12" "2023-07-03-18" "2023-07-04-00" "2023-07-04-06" "2023-07-04-12" "2023-07-04-18" "2023-07-05-00" "2023-07-05-06" "2023-07-05-12" "2023-07-05-18" "2023-07-06-00" "2023-07-06-06" "2023-07-06-12" "2023-07-06-18" "2023-07-07-00" "2023-07-07-06" "2023-07-07-12" "2023-07-07-18" "2023-07-08-00" "2023-07-08-06" "2023-07-08-12" "2023-07-08-18" "2023-07-09-00" "2023-07-09-06" "2023-07-09-12" "2023-07-09-18" "2023-07-10-00" "2023-07-10-06" "2023-07-10-12" "2023-07-10-18" "2023-07-11-00" "2023-07-11-06" "2023-07-11-12" "2023-07-11-18" "2023-07-12-00" "2023-07-12-06" "2023-07-12-12" "2023-07-12-18" "2023-07-13-00" "2023-07-13-06" "2023-07-13-12" "2023-07-13-18" "2023-07-14-00" "2023-07-14-06" "2023-07-14-12" "2023-07-14-18" "2023-07-15-00" "2023-07-15-06" "2023-07-15-12" "2023-07-15-18" "2023-07-16-00" "2023-07-16-06" "2023-07-16-12" "2023-07-16-18" "2023-07-17-00" "2023-07-17-06" "2023-07-17-12" "2023-07-17-18" "2023-07-18-00" "2023-07-18-06" "2023-07-18-12" "2023-07-18-18" "2023-07-19-00" "2023-07-19-06" "2023-07-19-12" "2023-07-19-18" "2023-07-20-00" "2023-07-20-06" "2023-07-20-12" "2023-07-20-18" "2023-07-21-00" "2023-07-21-06" "2023-07-21-12" "2023-07-21-18" "2023-07-22-00" "2023-07-22-06" "2023-07-22-12" "2023-07-22-18" "2023-07-23-00" "2023-07-23-06" "2023-07-23-12" "2023-07-23-18" "2023-07-24-00" "2023-07-24-06" "2023-07-24-12" "2023-07-24-18" "2023-07-25-00" "2023-07-25-06" "2023-07-25-12" "2023-07-25-18" "2023-07-26-00" "2023-07-26-06" "2023-07-26-12" "2023-07-26-18" "2023-07-27-00" "2023-07-27-06" "2023-07-27-12" "2023-07-27-18" "2023-07-28-00" "2023-07-28-06" "2023-07-28-12" "2023-07-28-18" "2023-07-29-00" "2023-07-29-06" "2023-07-29-12" "2023-07-29-18" "2023-07-30-00" "2023-07-30-06" "2023-07-30-12" "2023-07-30-18" "2023-07-31-00" "2023-07-31-06" "2023-07-31-12" "2023-07-31-18" "2023-08-01-00" "2023-08-01-06" "2023-08-01-12" "2023-08-01-18" "2023-08-02-00" "2023-08-02-06" "2023-08-02-12" "2023-08-02-18" "2023-08-03-00" "2023-08-03-06" "2023-08-03-12" "2023-08-03-18" "2023-08-04-00" "2023-08-04-06" "2023-08-04-12" "2023-08-04-18" "2023-08-05-00" "2023-08-05-06" "2023-08-05-12" "2023-08-05-18" "2023-08-06-00" "2023-08-06-06" "2023-08-06-12" "2023-08-06-18" "2023-08-07-00" "2023-08-07-06" "2023-08-07-12" "2023-08-07-18" "2023-08-08-00" "2023-08-08-06" "2023-08-08-12" "2023-08-08-18" "2023-08-09-00" "2023-08-09-06" "2023-08-09-12" "2023-08-09-18" "2023-08-10-00" "2023-08-10-06" "2023-08-10-12" "2023-08-10-18" "2023-08-11-00" "2023-08-11-06" "2023-08-11-12" "2023-08-11-18" "2023-08-12-00" "2023-08-12-06" "2023-08-12-12" "2023-08-12-18" "2023-08-13-00" "2023-08-13-06" "2023-08-13-12" "2023-08-13-18" "2023-08-14-00" "2023-08-14-06" "2023-08-14-12" "2023-08-14-18" "2023-08-15-00" "2023-08-15-06" "2023-08-15-12" "2023-08-15-18" "2023-08-16-00" "2023-08-16-06" "2023-08-16-12" "2023-08-16-18" "2023-08-17-00" "2023-08-17-06" "2023-08-17-12" "2023-08-17-18" "2023-08-18-00" "2023-08-18-06" "2023-08-18-12" "2023-08-18-18" "2023-08-19-00" "2023-08-19-06" "2023-08-19-12" "2023-08-19-18" "2023-08-20-00" "2023-08-20-06" "2023-08-20-12" "2023-08-20-18" "2023-08-21-00" "2023-08-21-06" "2023-08-21-12" "2023-08-21-18" "2023-08-22-00" "2023-08-22-06" "2023-08-22-12" "2023-08-22-18" "2023-08-23-00" "2023-08-23-06" "2023-08-23-12" "2023-08-23-18" "2023-08-24-00" "2023-08-24-06" "2023-08-24-12" "2023-08-24-18" "2023-08-25-00" "2023-08-25-06" "2023-08-25-12" "2023-08-25-18" "2023-08-26-00" "2023-08-26-06" "2023-08-26-12" "2023-08-26-18" "2023-08-27-00" "2023-08-27-06" "2023-08-27-12" "2023-08-27-18" "2023-08-28-00" "2023-08-28-06" "2023-08-28-12" "2023-08-28-18" "2023-08-29-00" "2023-08-29-06" "2023-08-29-12" "2023-08-29-18" "2023-08-30-00" "2023-08-30-06" "2023-08-30-12" "2023-08-30-18" "2023-08-31-00" "2023-08-31-06" "2023-08-31-12" "2023-08-31-18" "2023-09-01-00" "2023-09-01-06" "2023-09-01-12" "2023-09-01-18" "2023-09-02-00" "2023-09-02-06" "2023-09-02-12" "2023-09-02-18" "2023-09-03-00" "2023-09-03-06" "2023-09-03-12" "2023-09-03-18" "2023-09-04-00" "2023-09-04-06" "2023-09-04-12" "2023-09-04-18" "2023-09-05-00" "2023-09-05-06" "2023-09-05-12" "2023-09-05-18" "2023-09-06-00" "2023-09-06-06" "2023-09-06-12" "2023-09-06-18" "2023-09-07-00" "2023-09-07-06" "2023-09-07-12" "2023-09-07-18" "2023-09-08-00" "2023-09-08-06" "2023-09-08-12" "2023-09-08-18" "2023-09-09-00" "2023-09-09-06" "2023-09-09-12" "2023-09-09-18" "2023-09-10-00" "2023-09-10-06" "2023-09-10-12" "2023-09-10-18" "2023-09-11-00" "2023-09-11-06" "2023-09-11-12" "2023-09-11-18" "2023-09-12-00" "2023-09-12-06" "2023-09-12-12" "2023-09-12-18" "2023-09-13-00" "2023-09-13-06" "2023-09-13-12" "2023-09-13-18" "2023-09-14-00" "2023-09-14-06" "2023-09-14-12" "2023-09-14-18" "2023-09-15-00" "2023-09-15-06" "2023-09-15-12" "2023-09-15-18" "2023-09-16-00" "2023-09-16-06" "2023-09-16-12" "2023-09-16-18" "2023-09-17-00" "2023-09-17-06" "2023-09-17-12" "2023-09-17-18" "2023-09-18-00" "2023-09-18-06" "2023-09-18-12" "2023-09-18-18" "2023-09-19-00" "2023-09-19-06" "2023-09-19-12" "2023-09-19-18" "2023-09-20-00" "2023-09-20-06" "2023-09-20-12" "2023-09-20-18" "2023-09-21-00" "2023-09-21-06" "2023-09-21-12" "2023-09-21-18" "2023-09-22-00" "2023-09-22-06" "2023-09-22-12" "2023-09-22-18" "2023-09-23-00" "2023-09-23-06" "2023-09-23-12" "2023-09-23-18" "2023-09-24-00" "2023-09-24-06" "2023-09-24-12" "2023-09-24-18" "2023-09-25-00" "2023-09-25-06" "2023-09-25-12" "2023-09-25-18" "2023-09-26-00" "2023-09-26-06" "2023-09-26-12" "2023-09-26-18" "2023-09-27-00" "2023-09-27-06" "2023-09-27-12" "2023-09-27-18" "2023-09-28-00" "2023-09-28-06" "2023-09-28-12" "2023-09-28-18" "2023-09-29-00" "2023-09-29-06" "2023-09-29-12" "2023-09-29-18" "2023-09-30-00" "2023-09-30-06" "2023-09-30-12" "2023-09-30-18" "2023-10-01-00" "2023-10-01-06" "2023-10-01-12" "2023-10-01-18" "2023-10-02-00" "2023-10-02-06" "2023-10-02-12" "2023-10-02-18" "2023-10-03-00" "2023-10-03-06" "2023-10-03-12" "2023-10-03-18" "2023-10-04-00" "2023-10-04-06" "2023-10-04-12" "2023-10-04-18" "2023-10-05-00" "2023-10-05-06" "2023-10-05-12" "2023-10-05-18" "2023-10-06-00" "2023-10-06-06" "2023-10-06-12" "2023-10-06-18" "2023-10-07-00" "2023-10-07-06" "2023-10-07-12" "2023-10-07-18" "2023-10-08-00" "2023-10-08-06" "2023-10-08-12" "2023-10-08-18" "2023-10-09-00" "2023-10-09-06" "2023-10-09-12" "2023-10-09-18" "2023-10-10-00" "2023-10-10-06" "2023-10-10-12" "2023-10-10-18" "2023-10-11-00" "2023-10-11-06" "2023-10-11-12" "2023-10-11-18" "2023-10-12-00" "2023-10-12-06" "2023-10-12-12" "2023-10-12-18" "2023-10-13-00" "2023-10-13-06" "2023-10-13-12" "2023-10-13-18" "2023-10-14-00" "2023-10-14-06" "2023-10-14-12" "2023-10-14-18" "2023-10-15-00" "2023-10-15-06" "2023-10-15-12" "2023-10-15-18" "2023-10-16-00" "2023-10-16-06" "2023-10-16-12" "2023-10-16-18" "2023-10-17-00" "2023-10-17-06" "2023-10-17-12" "2023-10-17-18" "2023-10-18-00" "2023-10-18-06" "2023-10-18-12" "2023-10-18-18" "2023-10-19-00" "2023-10-19-06" "2023-10-19-12" "2023-10-19-18" "2023-10-20-00" "2023-10-20-06" "2023-10-20-12" "2023-10-20-18" "2023-10-21-00" "2023-10-21-06" "2023-10-21-12" "2023-10-21-18" "2023-10-22-00" "2023-10-22-06" "2023-10-22-12" "2023-10-22-18" "2023-10-23-00" "2023-10-23-06" "2023-10-23-12" "2023-10-23-18" "2023-10-24-00" "2023-10-24-06" "2023-10-24-12" "2023-10-24-18" "2023-10-25-00" "2023-10-25-06" "2023-10-25-12" "2023-10-25-18" "2023-10-26-00" "2023-10-26-06" "2023-10-26-12" "2023-10-26-18" "2023-10-27-00" "2023-10-27-06" "2023-10-27-12" "2023-10-27-18" "2023-10-28-00" "2023-10-28-06" "2023-10-28-12" "2023-10-28-18" "2023-10-29-00" "2023-10-29-06" "2023-10-29-12" "2023-10-29-18" "2023-10-30-00" "2023-10-30-06" "2023-10-30-12" "2023-10-30-18" "2023-10-31-00" "2023-10-31-06" "2023-10-31-12" "2023-10-31-18" "2023-11-01-00")
j=$SLURM_ARRAY_TASK_ID

while [ $j -le $(( $SLURM_ARRAY_TASK_ID + 9 )) ] && [ $j -lt ${#INIT_TIME_STRINGS[@]} ]; do
    init_time_string=${INIT_TIME_STRINGS[$j]}
    
    python3 -u "${CODE_DIR_NAME}/compute_derived_fields.py" \
    --derived_field_names "most-unstable-cape-j-kg01" "most-unstable-cin-j-kg01" "surface-based-cape-j-kg01" "surface-based-cin-j-kg01" "mixed-layer-cape-j-kg01_ml-depth-metres=500.0000" "mixed-layer-cin-j-kg01_ml-depth-metres=500.0000" "lifted-index-kelvins_top-pressure-pascals=50000" "precipitable-water-kg-m02_top-pressure-pascals=5000" "wind-shear-m-s01_top-pressure-pascals=50000_bottom-pressure-pascals=surface" "wind-shear-m-s01_top-pressure-pascals=85000_bottom-pressure-pascals=surface" "wind-shear-m-s01_top-pressure-pascals=20000_bottom-pressure-pascals=85000" "storm-relative-helicity-m2-s02_top-height-m-agl=3000.0000" "storm-relative-helicity-m2-s02_top-height-m-agl=1000.0000" "planetary-boundary-layer-height-m-agl" \
    --input_basic_field_dir_name="${INPUT_DIR_NAME}" \
    --model_name="FOUR_v200" \
    --init_time_string="${init_time_string}" \
    --do_multiprocessing=1 \
    --output_dir_name="${OUTPUT_DIR_NAME}"

    j=$(( $j + 1 ))
done
